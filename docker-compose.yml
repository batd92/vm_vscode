version: "3.8"

services:
    traefik:
        image: "traefik:v3.3"
        command:
            - "--api.insecure=true"
            - "--providers.docker=true"
            - "--entrypoints.web.address=:80"
            - "--entrypoints.websecure.address=:443"
            - "--certificatesresolvers.myresolver.acme.tlschallenge=true"
            - "--certificatesresolvers.myresolver.acme.email=admin@example.com"
            - "--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"
            - "--ping=true"
        ports:
            - "80:80"
            - "8080:8080"
            - "443:443"
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock:ro"
            - "./letsencrypt:/letsencrypt"
            - "./traefik/dynamic_conf.yml:/etc/traefik/dynamic_conf.yml"
        deploy:
            placement:
                constraints:
                - "node.role == manager"
volumes:
    letsencrypt:

networks:
    web:
        driver: overlay
